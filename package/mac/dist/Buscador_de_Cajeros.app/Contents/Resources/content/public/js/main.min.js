/* Overthrow v.0.1.0. An overflow:auto polyfill for responsive design. (c) 2012: Scott Jehl, Filament Group, Inc. http://filamentgroup.github.com/Overthrow/license.txt */
(function(k,d){var i=k.document,c=i.documentElement,b="overthrow-enabled",n="ontouchmove" in i,e="WebkitOverflowScrolling" in c.style||(!n&&k.screen.width>1200)||(function(){var p=k.navigator.userAgent,o=p.match(/AppleWebKit\/([0-9]+)/),r=o&&o[1],q=o&&r>=534;return(p.match(/Android ([0-9]+)/)&&RegExp.$1>=3&&q||p.match(/ Version\/([0-9]+)/)&&RegExp.$1>=0&&k.blackberry&&q||p.indexOf(/PlayBook/)>-1&&RegExp.$1>=0&&q||p.match(/Fennec\/([0-9]+)/)&&RegExp.$1>=4||p.match(/wOSBrowser\/([0-9]+)/)&&RegExp.$1>=233&&q||p.match(/NokiaBrowser\/([0-9\.]+)/)&&parseFloat(RegExp.$1)===7.3&&o&&r>=533)})(),j=function(p,o,r,q){return r*((p=p/q-1)*p*p+1)+o},h=false,g,m=function(r,x){var t=0,v=r.scrollLeft,w=r.scrollTop,q={top:"+0",left:"+0",duration:100,easing:k.overthrow.easing},u,p;if(x){for(var s in q){if(x[s]!==d){q[s]=x[s]}}}if(typeof q.left==="string"){q.left=parseFloat(q.left);u=q.left+v}else{u=q.left;q.left=q.left-v}if(typeof q.top==="string"){q.top=parseFloat(q.top);p=q.top+w}else{p=q.top;q.top=q.top-w}g=setInterval(function(){if(t++<q.duration){r.scrollLeft=q.easing(t,v,q.left,q.duration);r.scrollTop=q.easing(t,w,q.top,q.duration)}else{if(u!==r.scrollLeft){r.scrollLeft=u}if(p!==r.scrollTop){r.scrollTop=p}l()}},1);return{top:p,left:u,duration:q.duration,easing:q.easing}},a=function(p,o){return !o&&p.className&&p.className.indexOf("overthrow")>-1&&p||a(p.parentNode)},l=function(){clearInterval(g)},f=function(){if(h){return}h=true;if(e||n){c.className+=" "+b}k.overthrow.forget=function(){c.className=c.className.replace(b,"");if(i.removeEventListener){i.removeEventListener("touchstart",p,false)}k.overthrow.easing=j;h=false};if(e||!n){return}var s,w=[],o=[],v,y,x=function(){w=[];v=null},t=function(){o=[];y=null},r=function(){var C=(w[0]-w[w.length-1])*8,B=(o[0]-o[o.length-1])*8,A=Math.max(Math.abs(B),Math.abs(C))/8;C=(C>0?"+":"")+C;B=(B>0?"+":"")+B;if(!isNaN(A)&&A>0&&(Math.abs(B)>80||Math.abs(C)>80)){m(s,{left:B,top:C,duration:A})}},u,q=function(C){u=s.querySelectorAll("textarea, input");for(var B=0,A=u.length;B<A;B++){u[B].style.pointerEvents=C}},z=function(B,C){if(i.createEvent){var D=(!C||C===d)&&s.parentNode||s.touchchild||s,A;if(D!==s){A=i.createEvent("HTMLEvents");A.initEvent("touchend",true,true);s.dispatchEvent(A);D.touchchild=s;s=D;D.dispatchEvent(B)}}},p=function(I){l();x();t();s=a(I.target);if(!s||s===c||I.touches.length>1){return}q("none");var J=I,A=s.scrollTop,E=s.scrollLeft,K=s.offsetHeight,B=s.offsetWidth,F=I.touches[0].pageY,H=I.touches[0].pageX,L=s.scrollHeight,G=s.scrollWidth,C=function(P){var M=A+F-P.touches[0].pageY,N=E+H-P.touches[0].pageX,Q=M>=(w.length?w[0]:0),O=N>=(o.length?o[0]:0);if((M>0&&M<L-K)||(N>0&&N<G-B)){P.preventDefault()}else{z(J)}if(v&&Q!==v){x()}if(y&&O!==y){t()}v=Q;y=O;s.scrollTop=M;s.scrollLeft=N;w.unshift(M);o.unshift(N);if(w.length>3){w.pop()}if(o.length>3){o.pop()}},D=function(M){r();q("auto");setTimeout(function(){q("none")},450);s.removeEventListener("touchmove",C,false);s.removeEventListener("touchend",D,false)};s.addEventListener("touchmove",C,false);s.addEventListener("touchend",D,false)};i.addEventListener("touchstart",p,false)};k.overthrow={set:f,forget:function(){},easing:j,toss:m,intercept:l,closest:a,support:e?"native":n&&"polyfilled"||"none"};f()})(this);(function(a){window.MBP=window.MBP||{};MBP.viewportmeta=a.querySelector&&a.querySelector('meta[name="viewport"]');MBP.ua=navigator.userAgent;MBP.scaleFix=function(){if(MBP.viewportmeta&&/iPhone|iPad|iPod/.test(MBP.ua)&&!/Opera Mini/.test(MBP.ua)){MBP.viewportmeta.content="width=device-width, minimum-scale=1.0, maximum-scale=1.0";a.addEventListener("gesturestart",MBP.gestureStart,false)}};MBP.gestureStart=function(){MBP.viewportmeta.content="width=device-width, minimum-scale=0.25, maximum-scale=1.6"};MBP.BODY_SCROLL_TOP=false;MBP.getScrollTop=function(){var e=window;var d=a;return e.pageYOffset||d.compatMode==="CSS1Compat"&&d.documentElement.scrollTop||d.body.scrollTop||0};MBP.hideUrlBar=function(){var d=window;if(!location.hash&&MBP.BODY_SCROLL_TOP!==false){d.scrollTo(0,MBP.BODY_SCROLL_TOP===1?0:1)}};MBP.hideUrlBarOnLoad=function(){var f=window;var e=f.document;var d;if(!location.hash&&f.addEventListener){window.scrollTo(0,1);MBP.BODY_SCROLL_TOP=1;d=setInterval(function(){if(e.body){clearInterval(d);MBP.BODY_SCROLL_TOP=MBP.getScrollTop();MBP.hideUrlBar()}},15);f.addEventListener("load",function(){setTimeout(function(){if(MBP.getScrollTop()<20){MBP.hideUrlBar()}},0)})}};MBP.fastButton=function(e,f,d){this.handler=f;this.pressedClass=typeof d==="undefined"?"pressed":d;if(e.length&&e.length>1){for(var g in e){this.addClickEvent(e[g])}}else{this.addClickEvent(e)}};MBP.fastButton.prototype.handleEvent=function(d){d=d||window.event;switch(d.type){case"touchstart":this.onTouchStart(d);break;case"touchmove":this.onTouchMove(d);break;case"touchend":this.onClick(d);break;case"click":this.onClick(d);break}};MBP.fastButton.prototype.onTouchStart=function(e){var d=e.srcElement;e.stopPropagation();d.addEventListener("touchend",this,false);a.body.addEventListener("touchmove",this,false);this.startX=e.touches[0].clientX;this.startY=e.touches[0].clientY;d.className+=" "+this.pressedClass};MBP.fastButton.prototype.onTouchMove=function(d){if(Math.abs(d.touches[0].clientX-this.startX)>10||Math.abs(d.touches[0].clientY-this.startY)>10){this.reset(d)}};MBP.fastButton.prototype.onClick=function(e){e=e||window.event;var d=e.srcElement;if(e.stopPropagation){e.stopPropagation()}this.reset(e);this.handler.apply(e.currentTarget,[e]);if(e.type=="touchend"){MBP.preventGhostClick(this.startX,this.startY)}var f=new RegExp(" ?"+this.pressedClass,"gi");d.className=d.className.replace(f,"")};MBP.fastButton.prototype.reset=function(e){var d=e.srcElement;b(d,"touchend",this,false);b(a.body,"touchmove",this,false);var f=new RegExp(" ?"+this.pressedClass,"gi");d.className=d.className.replace(f,"")};MBP.fastButton.prototype.addClickEvent=function(d){c(d,"touchstart",this,false);c(d,"click",this,false)};MBP.preventGhostClick=function(d,e){MBP.coords.push(d,e);window.setTimeout(function(){MBP.coords.splice(0,2)},2500)};MBP.ghostClickHandler=function(g){if(!MBP.hadTouchEvent&&MBP.dodgyAndroid){g.stopPropagation();g.preventDefault();return}for(var f=0,e=MBP.coords.length;f<e;f+=2){var d=MBP.coords[f];var h=MBP.coords[f+1];if(Math.abs(g.clientX-d)<25&&Math.abs(g.clientY-h)<25){g.stopPropagation();g.preventDefault()}}};MBP.dodgyAndroid=("ontouchstart" in window)&&(navigator.userAgent.indexOf("Android 2.3")!=-1);if(a.addEventListener){a.addEventListener("click",MBP.ghostClickHandler,true)}c(a.documentElement,"touchstart",function(){MBP.hadTouchEvent=true},false);MBP.coords=[];function c(h,f,g,d){if("addEventListener" in h){try{h.addEventListener(f,g,d)}catch(i){if(typeof g=="object"&&g.handleEvent){h.addEventListener(f,function(j){g.handleEvent.call(g,j)},d)}else{throw i}}}else{if("attachEvent" in h){if(typeof g=="object"&&g.handleEvent){h.attachEvent("on"+f,function(){g.handleEvent.call(g)})}else{h.attachEvent("on"+f,g)}}}}function b(h,f,g,d){if("removeEventListener" in h){try{h.removeEventListener(f,g,d)}catch(i){if(typeof g=="object"&&g.handleEvent){h.removeEventListener(f,function(j){g.handleEvent.call(g,j)},d)}else{throw i}}}else{if("detachEvent" in h){if(typeof g=="object"&&g.handleEvent){h.detachEvent("on"+f,function(){g.handleEvent.call(g)})}else{h.detachEvent("on"+f,g)}}}}MBP.autogrow=function(f,d){function g(j){var i=this.scrollHeight;var k=this.clientHeight;if(i>k){this.style.height=i+3*h+"px"}}var e=(d)?d:12;var h=f.currentStyle?f.currentStyle.lineHeight:getComputedStyle(f,null).lineHeight;h=(h.indexOf("px")==-1)?e:parseInt(h,10);f.style.overflow="hidden";f.addEventListener?f.addEventListener("keyup",g,false):f.attachEvent("onkeyup",g)};MBP.enableActive=function(){a.addEventListener("touchstart",function(){},false)};MBP.preventScrolling=function(){a.addEventListener("touchmove",function(d){d.preventDefault()},false)};MBP.preventZoom=function(){var e=a.querySelectorAll("input, select, textarea");var f="width=device-width,initial-scale=1,maximum-scale=";var d=0;for(d=0;d<e.length;d++){e[d].onfocus=function(){MBP.viewportmeta.content=f+"1"};e[d].onblur=function(){MBP.viewportmeta.content=f+"10"}}};MBP.startupImage=function(){var i;var g;var h;var f;var e;var d;h=window.devicePixelRatio;f=a.getElementsByTagName("head")[0];if(navigator.platform==="iPad"){i=h===2?"img/startup/startup-tablet-portrait-retina.png":"img/startup/startup-tablet-portrait.png";g=h===2?"img/startup/startup-tablet-landscape-retina.png":"img/startup/startup-tablet-landscape.png";e=a.createElement("link");e.setAttribute("rel","apple-touch-startup-image");e.setAttribute("media","screen and (orientation: portrait)");e.setAttribute("href",i);f.appendChild(e);d=a.createElement("link");d.setAttribute("rel","apple-touch-startup-image");d.setAttribute("media","screen and (orientation: landscape)");d.setAttribute("href",g);f.appendChild(d)}else{i=h===2?"img/startup/startup-retina.png":"img/startup/startup.png";e=a.createElement("link");e.setAttribute("rel","apple-touch-startup-image");e.setAttribute("href",i);f.appendChild(e)}}})(document);(function(l){var m=1;var G=2;var H=m;MBP.preventZoom();if(l.location.pathname!=="/"){$(".location").hide();$(".form-search").hide();$(".btn-locate").on("click",function(){l.location.href="/"});$("#content").addClass("inner-page")}$("a[rel='external']").attr("target","_blank");$(".nav-tabs a").each(function(J,I){if(!$(this).parent().hasClass("active")){$($(this).attr("href")).hide()}});$(".nav-tabs a").on("click",function(I){I.preventDefault();if($(this).parent().hasClass("active")){return}$($(this).parents(".nav-tabs").find("li.active a").attr("href")).removeClass("in").hide();$(this).parents(".nav-tabs").find("li").removeClass("active");$(this).parent().addClass("active");$($(this).attr("href")).show().addClass("in");u()});$(".btn-search").on("click",function(J){var I=$(this).parents("form").find(".search-container");if(I.hasClass("hide")){I.toggleClass("hide").toggleClass("in");$(this).parents("form").find("input.search-query").eq(0).focus();return}$(this).parents("form").trigger("submit")});$(l).on("pageshow load resize orientationchange",u);var r=$("#content");var z=$("#map");var F=$("#header");var w=$("#footer");var d=$(".nav-tabs a[href='#route-container']");var k=$(".nav-tabs a[href='#list-container']");function u(){var I=Math.round(F.height());var J=Math.round(w.height());r.css("height","auto");r.css({position:"absolute",top:I,left:0,right:0,bottom:J});if(document.documentElement.clientWidth>=780){if(H!==G){H=G;z.remove().appendTo("body");d.trigger("click").text("Cajero más cercano");k.text("Otros cajeros")}z.css({top:I,bottom:J})}else{if(H!==m){H=m;z.remove().appendTo("#map-container");$(".nav-tabs a[href='#map-container']").trigger("click");$(".nav-tabs a[href='#route-container']").html('<i class="icon-info-circle"></i> Info.');$(".nav-tabs a[href='#list-container']").html('<i class="icon-list"></i> Lista')}z.css({top:"",bottom:""})}google.maps.event.trigger(E,"resize");E.setZoom(E.getZoom())}var E;var v;var x=google.maps.DirectionsTravelMode.WALKING;var f;var o=new google.maps.DirectionsService();var e=[];var t=[];var c=false;var g=[];var i=false;var A=[];var p=false;$(".btn-drive").click(function(){x=google.maps.DirectionsTravelMode.DRIVING;$(this).parent().find("button").removeClass("active");$(this).addClass("active");h(i);_gaq.push(["_trackEvent","Button","Travel Mode","Driving"])});$(".btn-walk").click(function(){x=google.maps.DirectionsTravelMode.WALKING;$(this).parent().find("button").removeClass("active");$(this).addClass("active");h(i);_gaq.push(["_trackEvent","Button","Travel Mode","Walking"])});$(".btn-network").click(function(){p=false;$(this).parent().find("button").removeClass("active");$(this).addClass("active");y(function(){i=g[0];h(i)})});$(".btn-network-banelco").click(function(){p="Banelco";$(this).parent().find("button").removeClass("active");$(this).addClass("active");y(function(){i=g[0];h(i)});_gaq.push(["_trackEvent","Button","Network","Banelco"])});$(".btn-network-link").click(function(){p="Link";$(this).parent().find("button").removeClass("active");$(this).addClass("active");y(function(){i=g[0];h(i)});_gaq.push(["_trackEvent","Button","Network","Link"])});$(".change-atm").live("click",function(I){I.preventDefault();$(this).parents("#atm-list").find(".active").removeClass("active");$(this).addClass("active");i=g[$(this).attr("data-atm")];h(i)});$(".form-search").on("submit",function(I){I.preventDefault();$(this).find(".btn-search").focus();j($(this).find("input.search-query").val()+", Buenos Aires, Argentina",function(J){C(J.lat(),J.lng(),function(){y(function(){i=g[0];h(i)})})});$(this).find(".search-container").toggleClass("hide").toggleClass("in");_gaq.push(["_trackEvent","Button","Search"])});$("#report").click(function(I){s(i.cartodb_id)});$(".btn-locate").on("click",function(I){D();$('a[href="#map-container"]').trigger("click");_gaq.push(["_trackEvent","Button","My location"])});a();D();function D(){if(!navigator.geolocation){$(".location p").html("Parece que tu dispositivo no soporta geolocalización. Ingresá manualmente tu ubicación.");u();return}navigator.geolocation.getCurrentPosition(function(I){C(I.coords.latitude,I.coords.longitude);u();y(function(){i=g[0];h(i)});_gaq.push(["_trackEvent","Location","Ok"])},function(){$(".location p").html("Oops! no te pudimos localizar. Ingresá manualmente tu ubicación.");_gaq.push(["_trackEvent","Location","Error"]);u()})}function a(){var I={zoom:18,center:new google.maps.LatLng(-34.5324,-58.4685),mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:false,scaleControl:false,mapTypeControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_BOTTOM},};E=new google.maps.Map(document.getElementById("map"),I);f=new google.maps.DirectionsRenderer({map:E});E.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(document.getElementById("legend"))}function y(J){var I="SELECT cartodb_id, ST_X(ST_Centroid(the_geom)) as longitude,ST_Y(ST_Centroid(the_geom)) as latitude, description as _desc, name, red, notes, ST_Distance(the_geom::geography, ST_PointFromText('POINT("+e[1]+" "+e[0]+")', 4326)::geography) AS distance FROM atms20120930 ";if(p){I+=" WHERE red = '"+p+"' "}I+=" ORDER BY distance ASC LIMIT 10";$.getJSON("http://vulsai.cartodb.com/api/v2/sql/?q="+I,function(L){var K="active";g=[];q();$("#atm-list").html("");$.each(L.rows,function(M,N){var O=N.distance;if(O>500000){return}g[M]=N;g[M].glocation=new google.maps.LatLng(N.latitude,N.longitude);if(N.latitude&&N.longitude){A[M]=new google.maps.Marker({position:g[M].glocation,map:E,icon:"http://www.google.com/intl/en_us/mapfiles/ms/micons/green-dot.png",title:N._desc});google.maps.event.addListener(A[M],"click",function(){i=g[M];h(g[M])});O=N.distance;if(O>1000){O=Math.round(O/1000,2)+" km."}else{O=Math.round(O)+" mts."}$("#atm-list").append('<li><a class="change-atm '+K+'" href="#" data-atm="'+M+'">'+N.name+'<div class="distance pull-right">'+O+"</div></a></li>");if(K==="active"){K=""}}});if(!g.length){n();return}J&&J()})}function n(){alert("No hay ningún cajero cerca!");$(".no-results").show();$("#current-distance").html("").parents(".distance").addClass("hide");$("#current-title").html("");$("#current-address").html("");$("#current-network").addClass("hide");$("#route").html("")}function C(K,I,J){e=[K,I];t=new google.maps.LatLng(K,I);E.panTo(t);if(c!=false){c.setMap(null);c=false}c=new google.maps.Marker({position:t,map:E,icon:"http://www.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png",draggable:true,title:"Estas aca!"});google.maps.event.addListener(c,"dragend",function(){t=c.getPosition();e=[t.lat(),t.lng()];y(function(){i=g[0];h(i)});b()});b();J&&J()}function h(K){if(e.length){$("#route").html("");var I=K._desc.replace("\n"," - ");if(K.notes){I=I+" ("+K.notes+")"}var L=K.distance;if(L>1000){L=Math.round(L/1000,2)+" km."}else{L=Math.round(L)+" mts."}$(".no-results").hide();$("#current-distance").html(L).parents(".distance").removeClass("hide");$("#current-title").html(K.name);$("#current-address").html(I.replace("\n"," - "));$("#current-network").attr("src","img/logo-"+K.red.toLowerCase()+".png").attr("alt",K.red).removeClass("hide");var J={origin:t,destination:K.glocation,travelMode:x};o.route(J,function(M,N){if(N==google.maps.DirectionsStatus.OK){$(M.routes[0].legs[0].steps).each(function(P,O){$("#route").append("<li>"+O.instructions+"</li>")});f.suppressMarkers=true;v=M;B()}});if(document.documentElement.clientWidth>=780){$('a[href="#route-container"]').trigger("click")}else{$('a[href="#map-container"]').trigger("click")}u()}}function B(){f.setDirections(v);u()}function q(){$(A).each(function(I){A[I].setMap(null)});A=[]}function b(){var I=new google.maps.Geocoder();I.geocode({location:t},function(L,K){if(K=="OK"){var J=L[0].formatted_address.replace(", Buenos Aires, Ciudad Autónoma de Buenos Aires, Argentina","");$(".location p").html('Al parecer estás en <span class="mark">'+J+"</span>");$(".form-search input.search-query").val(J);u()}})}function j(K,J){var I=new google.maps.Geocoder();I.geocode({address:K},function(M,L){if(L=="OK"){J(M[0].geometry.location)}else{alert("No pudimos encontrar tu dirección. Por favor, revisá si la ingresaste correctamente.")}})}function s(I){$.getJSON("/report/"+I,function(J){if(J=="true"){return true}return false})}}(window));